model Conversation {
  id String @id @default(uuid())

  type   ConversationType @default(DIRECT)
  title  String?
  avatar String?

  // Just a pointer (NOT a relation)
  lastMessageId String?

  messages Message[]
  members  ConversationMember[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([lastMessageId])
}

model ConversationMember {
  id String @id @default(uuid())

  conversationId String
  userId         String

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  role ConversationRole @default(MEMBER)

  nickname String?
  theme    ConversationTheme @default(LIGHT)
  emoji    String            @default("LIKE")

  isMuted  Boolean @default(false)
  isPinned Boolean @default(false)
  archived Boolean @default(false)

  joinedAt DateTime  @default(now())
  leftAt   DateTime?

  @@unique([conversationId, userId])
  @@index([userId])
}

enum ConversationType {
  DIRECT
  GROUP
}

enum ConversationRole {
  ADMIN
  MEMBER
}

enum ConversationTheme {
  LIGHT
  DARK
  MIDNIGHT
  OCEAN
  SUNSET
  FOREST
  PASTEL
  ROSE
  CYBERPUNK
  AUTUMN
}
